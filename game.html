<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Chaos Mode</title>
</head>
<body style="margin:0; overflow:hidden; background:black;">
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let player = { x: 100, y: 100, size: 40 };

let enemies = [];

for (let i = 0; i < 30; i++) {
  enemies.push({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    size: 40,
    speed: 1 + Math.random() * 2
  });
}

let score = 0;
let gameOver = false;

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if (gameOver) {
    ctx.fillStyle = "white";
    ctx.font = "80px serif";
    ctx.fillText("どんまい 笑", canvas.width/2 - 200, canvas.height/2);
    return;
  }

  // プレイヤー描画
  ctx.fillStyle = "lime";
  ctx.fillRect(player.x, player.y, player.size, player.size);

  // 敵処理
  enemies.forEach(enemy => {

    if (player.x > enemy.x) enemy.x += enemy.speed;
    if (player.x < enemy.x) enemy.x -= enemy.speed;
    if (player.y > enemy.y) enemy.y += enemy.speed;
    if (player.y < enemy.y) enemy.y -= enemy.speed;

    ctx.fillStyle = "red";
    ctx.fillRect(enemy.x, enemy.y, enemy.size, enemy.size);

    // 当たり判定
    if (
      player.x < enemy.x + enemy.size &&
      player.x + player.size > enemy.x &&
      player.y < enemy.y + enemy.size &&
      player.y + player.size > enemy.y
    ) {
      gameOver = true;
    }
  });

  ctx.fillStyle = "white";
  ctx.font = "40px Arial";
  ctx.fillText("Score: " + score, 20, 30);

  requestAnimationFrame(draw);
}

document.addEventListener("touchstart", e => {
  if (!gameOver) {
    player.x = e.touches[0].clientX - player.size/2;
    player.y = e.touches[0].clientY - player.size/2;
    score++;
  }
});

draw();
</script>
</body>
</html>
