<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Chaos Mode</title>
  <style>
    #restartBtn {
      position: absolute;
      left: 50%;
      top: 60%;
      transform: translate(-50%, -50%);
      padding: 15px 30px;
      font-size: 30px;
      display: none; /* 最初は非表示 */
      cursor: pointer;
    }
  </style>
</head>
<body style="margin:0; overflow:hidden; background:black;">
<canvas id="game"></canvas>
<button id="restartBtn">リスタート</button>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let player, enemies, score, gameOver;

function initGame() {
  player = { x: 100, y: 100, size: 40 };

  enemies = [];
  for (let i = 0; i < 30; i++) {
    enemies.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      size: 40,
      speed: 1 + Math.random() * 2
    });
  }

  score = 0;
  gameOver = false;

  document.getElementById("restartBtn").style.display = "none";
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if (gameOver) {
    ctx.fillStyle = "white";
    ctx.font = "80px serif";
    ctx.fillText("どんまい 笑", canvas.width/2 - 200, canvas.height/2);

    // ボタンを表示
    document.getElementById("restartBtn").style.display = "block";
    return;
  }

  // プレイヤー描画
  ctx.fillStyle = "lime";
  ctx.fillRect(player.x, player.y, player.size, player.size);

  // 敵処理
  enemies.forEach(enemy => {

    if (player.x > enemy.x) enemy.x += enemy.speed;
    if (player.x < enemy.x) enemy.x -= enemy.speed;
    if (player.y > enemy.y) enemy.y += enemy.speed;
    if (player.y < enemy.y) enemy.y -= enemy.speed;

    ctx.fillStyle = "red";
    ctx.fillRect(enemy.x, enemy.y, enemy.size, enemy.size);

    // 当たり判定
    if (
      player.x < enemy.x + enemy.size &&
      player.x + player.size > enemy.x &&
      player.y < enemy.y + enemy.size &&
      player.y + player.size > enemy.y
    ) {
      gameOver = true;
    }
  });

  ctx.fillStyle = "white";
  ctx.font = "40px Arial";
  ctx.fillText("Score: " + score, 20, 30);

  requestAnimationFrame(draw);
}

// タッチでプレイヤー移動
document.addEventListener("touchstart", e => {
  if (!gameOver) {
    player.x = e.touches[0].clientX - player.size/2;
    player.y = e.touches[0].clientY - player.size/2;
    score++;
  }
});

// リスタートボタン処理
document.getElementById("restartBtn").addEventListener("click", () => {
  initGame();
  draw();
});

// 初回ゲーム開始
initGame();
draw();
</script>
</body>
</html>

<!-- リスタートボタンの下に追加 -->
<button id="homeBtn" style="
  position:absolute;
  left:50%;
  top:70%;
  transform:translate(-50%,-50%);
  padding:15px 30px;
  font-size:30px;
  display:none;
  cursor:pointer;
">ホームに戻る</button>

<script>
const homeBtn = document.getElementById("homeBtn");
const restartBtn = document.getElementById("restartBtn");

// ゲームオーバー時
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if (gameOver) {
    ctx.fillStyle = "white";
    ctx.font = "80px serif";
    ctx.fillText("どんまい 笑", canvas.width/2 - 200, canvas.height/2);

    // ボタン表示
    restartBtn.style.display = "block";
    homeBtn.style.display = "block"; // ←ホームボタンも表示
    return;
  }

  // （残りの描画処理は同じ）
}

// ホームボタン押したらindex.htmlに戻る
homeBtn.addEventListener("click", () => {
  window.location.href = "index.html";
});
</script>
